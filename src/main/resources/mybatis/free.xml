<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="free">

    <select id="total" resultType="Integer">
        SELECT COUNT(*)
        FROM free
    </select>

    <sql id="search">
        SELECT * FROM free

        <if test="search == 1">
            <where>
                name LIKE CONCAT(CONCAT('%', #{keyword}), '%')
            </where>
        </if>

        ORDER BY num desc
        LIMIT ${offset},${perPage}
    </sql>

    <select id="list" resultType="Free">
        SELECT * FROM (<include refid="search"></include>) T1
    </select>
    <delete id="delete">
        DELETE
        FROM free
        WHERE num = #{num}
    </delete>
    <insert id="add">
        INSERT INTO free (name, pub_date, user_id, contents)
        VALUES (#{name}, now(), #{userId}, #{contents})
    </insert>
    <update id="update">
        UPDATE free
        SET name=#{name},
            contents=#{contents}
        WHERE num = #{num}
    </update>
    <select id="item" resultType="Free">
        SELECT free.*, user.id
        FROM free
                 left join user on free.user_id = user.id
        WHERE free.num = #{num}

    </select>
    <insert id="replyAdd">
        INSERT INTO reply (replyContent, replyWriter, replyFreeNum)
        VALUES (#{replyContent}, #{replyWriter}, #{replyFreeNum})
    </insert>

    <select id="replyList" resultType="Reply">
        SELECT reply.replyNum, reply.replyContent,reply.regDate,user.id
        FROM reply LEFT JOIN free ON(reply.replyFreeNum=free.num)
                   LEFT JOIN user ON(reply.replyWriter=user.num)
        WHERE replyFreeNum = #{num}
    </select>
</mapper>